<div class="container-fluid view-items">
    <app-header>Edit Item</app-header>

    <div class="row">
        <div class="col-8">

            <div class="panel">
                <form novalidate [formGroup]="itemForm" (ngSubmit)="addItem()">
                    <input type="hidden" formControlName="id">
                    <h2>Item Information:</h2>
                    <div class="section">
                        <div class="row">
                            <div class="col">
                                <mat-form-field appearance="outline" class="form-control">
                                    <mat-label>Name</mat-label>
                                    <input matInput placeholder="Item name" value="" required formControlName="name">
                                    <mat-error *ngIf="itemForm.get('name').hasError('required')">
                                        Item name is required.
                                    </mat-error>
                                </mat-form-field>
                                <mat-checkbox formControlName="knownByName">Known by name?</mat-checkbox>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <app-item-type-selector formControlName="itemType"
                                    [currentValue]="currentItemTypeValue"></app-item-type-selector>
                            </div>
                            <div class="col-3">
                                <app-item-slot-selector formControlName="itemSlotType"
                                    [currentValue]="currentItemSlotValue">
                                </app-item-slot-selector>

                            </div>
                            <div class="col-3">
                                <mat-form-field appearance="outline">
                                    <mat-label>Minimum Level</mat-label>
                                    <input matInput type="number" placeholder="Minimum Level" formControlName="level">
                                    <mat-hint align="start"><strong>The level player needs to use this item</strong>
                                    </mat-hint>
                                </mat-form-field>
                            </div>
                            <div class="col-3">
                                <mat-form-field appearance="outline">
                                    <mat-label>Value</mat-label>
                                    <input matInput type="number" placeholder="Item worth" formControlName="value">
                                    <mat-hint align="start"><strong>How much to buy from vendor. Minus markup</strong>
                                    </mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>


                    <div *ngIf="showPortalSection">
                        <h2>Portal</h2>
                        <div class="section">
                            <div class="row">
                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Name</mat-label>
                                        <input matInput type="text" placeholder="Portal Name"
                                            formControlName="portalName">

                                    </mat-form-field>
                                </div>

                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Destination</mat-label>
                                        <input matInput type="text" placeholder="Destination"
                                            formControlName="portalDestination">
                                        <mat-hint>areaId + y + x + z coords. e.g "1000"</mat-hint>
                                    </mat-form-field>
                                </div>


                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Enter portal Description</mat-label>
                                        <input matInput type="text" placeholder="Enter portal description"
                                            formControlName="portalEnterDescription">

                                    </mat-form-field>
                                </div>

                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Enter Room Description</mat-label>
                                        <input matInput type="text" placeholder="Enter room description"
                                            formControlName="portalEnterRoomDescription">

                                    </mat-form-field>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div *ngIf="showWeaponSection">
                        <h2>Weapon</h2>
                        <div class="section">
                            <div class="row">
                                <div class="col-4">
                                    <app-weapon-type-selector formControlName="weaponType"
                                        [currentValue]="this.itemForm.get('weaponType').value">
                                    </app-weapon-type-selector>
                                </div>

                                <div class="col-4">
                                    <app-attack-type-selector formControlName="attackType"
                                        [currentValue]="this.itemForm.get('attackType').value">
                                    </app-attack-type-selector>
                                </div>

                                <div class="col-4">
                                    <app-damage-type-selector formControlName="damageType"
                                        [currentValue]="this.itemForm.get('damageType').value">
                                    </app-damage-type-selector>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Min Damage</mat-label>
                                        <input matInput type="number" placeholder="Minimum Damage"
                                            formControlName="minDamage" required>
                                        <mat-error *ngIf="itemForm.get('minDamage').hasError('required')">
                                            Min damage is required.
                                        </mat-error>
                                        <mat-hint align="start"><strong>can be 1 to 50</strong> </mat-hint>
                                    </mat-form-field>
                                </div>

                                <div class="col-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Max Damage</mat-label>
                                        <input matInput type="number" placeholder="Maximum Damage"
                                            formControlName="maxDamage" required>
                                        <mat-error *ngIf="itemForm.get('maxDamage').hasError('required')">
                                            Max damage is required.
                                        </mat-error>
                                        <mat-hint align="start"><strong>can be 1 to 100</strong> </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div *ngIf="showArmourSection">
                        <h2>Armour</h2>
                        <div class="section">
                            <div class="row">
                                <div class="col">
                                    <app-armour-type-selector formControlName="armourType"
                                        [currentValue]="this.itemForm.get('armourType').value">
                                    </app-armour-type-selector>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Armour</mat-label>
                                        <input matInput type="number" placeholder="Armour" formControlName="acPierce">
                                    </mat-form-field>
                                </div>

                                <div class="col">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Spell Protection</mat-label>
                                        <input matInput readonly type="number" placeholder="AC magic"
                                            formControlName="acMagic"
                                            [value]="calculateSpellProtection(this.itemForm.get('acPierce').value)">
                                        <mat-hint align="start"><strong>Half of armour protection</strong> </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <mat-checkbox formControlName="isTwoHanded" title="Is a two handed weapon">
                                    Is Two-handed</mat-checkbox>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="showBookSection">
                        <h2>Book</h2>
                        <div class="section">
                            <div class="row">
                                <div class="col">

                                    <mat-form-field appearance="outline">
                                        <mat-label>Number of pages</mat-label>
                                        <input matInput type="number" placeholder="Number of pages"
                                            formControlName="pagesCount" [value]="itemForm.get('pageCount').value"
                                            required>
                                        <mat-error *ngIf="itemForm.get('pageCount').hasError('required')">
                                            Number of pages is required.
                                        </mat-error>
                                        <mat-hint align="start"><strong>Limits how many pages you're allowed to
                                                add</strong>
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row" [formGroup]="itemForm.get('pages')">

                                <div class="col-12" *ngFor="let page of pages; let i = index;">

                                    <mat-form-field appearance="outline">
                                        <mat-label>Page {{i + 1}}</mat-label>
                                        <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                            cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20" formControlName="page{{i}}"
                                            [value]="selectedItem?.book?.pages[i]"></textarea>
                                        <mat-hint align="start"><strong>Markdown accepted.</strong>
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                                <a mat-raised-button color="secondary" (click)="addPage()"
                                    *ngIf="pages.length + 1 <= itemForm.get('pageCount').value">Add
                                    another page</a>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="showContainerSection">
                        <h2>Container</h2>
                        <div class="section">
                            <div class="row">
                                <div class="col">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Container size</mat-label>
                                        <mat-select placeholder="Container size" formControlName="containerSize"
                                            required>
                                            <mat-option *ngFor="let size of containerSize" [value]="size.id">
                                                {{size.id | containerSize: itemForm.get('containerSize').value}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">

                                    <mat-checkbox formControlName="containerCanOpen">Can Open</mat-checkbox>

                                </div>
                                <div class="col">
                                    <mat-checkbox [attr.disabled]="!containerCanBeOpened"
                                        formControlName="containerOpen">Is
                                        Open
                                    </mat-checkbox>
                                </div>

                                <div class="col">
                                    <mat-checkbox formControlName="containerCanLock">Can Lock</mat-checkbox>
                                </div>
                                <div class="col">
                                    <mat-checkbox [attr.disabled]="!containerCanBeLocked"
                                        formControlName="containerLocked">
                                        Is
                                        Locked</mat-checkbox>
                                </div>
                            </div>

                            <div [hidden]="!containerCanBeLocked">
                                <div class="row">
                                    <div class="col">

                                        <mat-form-field class="example-full-width" appearance="outline">
                                            <mat-label>Associate a key</mat-label>
                                            <input type="text" placeholder="Associate a key"
                                                aria-label="Link key to container lock" matInput
                                                formControlName="selectContainerKey" [matAutocomplete]="autoKeys">
                                            <mat-autocomplete #autoKeys="matAutocomplete">
                                                <mat-option *ngFor="let option of findKeyOptions | async"
                                                    [value]="option.name">
                                                    {{option.name}}
                                                </mat-option>
                                            </mat-autocomplete>
                                        </mat-form-field>

                                    </div>

                                    <div class="col">
                                        <mat-form-field appearance="outline">
                                            <mat-label>Lock strength</mat-label>
                                            <mat-select placeholder="Lock strength" formControlName="lockStrength">
                                                <mat-option *ngFor="let lock of lockStrength" [value]="lock.id">
                                                    {{lock.name}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col">
                                    <strong>Container Items</strong>
                                    <ul>
                                        <li *ngFor="let item of containerItems; let i = index">{{item.name}} <a
                                                href="javascript:void(0)"
                                                (click)="removeItemFromContainer(i)">Remove</a>
                                        </li>

                                    </ul>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">

                                    <mat-form-field class="example-full-width" appearance="outline">
                                        <mat-label>Search for an item</mat-label>
                                        <input type="text" placeholder="Search for an item" aria-label="Assignee"
                                            matInput formControlName="selectContainerItem" [matAutocomplete]="auto">
                                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                                            <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                                                {{option.name}}
                                            </mat-option>
                                        </mat-autocomplete>
                                    </mat-form-field>
                                    <button type="button" mat-raised-button color="secondary"
                                        (click)="addItemToContainer()">Add
                                        item</button>
                                </div>
                                <div class="col">
                                    <mat-form-field class="example-full-width" appearance="outline">
                                        <mat-label>Gold pieces</mat-label>
                                        <input type="number" placeholder="add Gold pieces" aria-label="Add gold coins"
                                            matInput formControlName="containerGP">
                                    </mat-form-field>

                                </div>

                            </div>
                        </div>

                    </div>

                    <div *ngIf="showKeySection">
                        <h2>Key Id</h2>
                        <p>You will need to copy and paste this in the associated key field for doors and
                            containers</p><br />
                        <div class="section">
                            <div class="row">
                                <div class="col">

                                    <mat-form-field appearance="outline">
                                        <mat-label>Key ID</mat-label>
                                        <input matInput type="text" placeholder="Key Id" formControlName="keyId"
                                            readonly>
                                    </mat-form-field>
                                </div>
                            </div>



                        </div>


                    </div>

<!-- 

                    <div *ngIf="showModifiers">
                        <h2>Consumables buff/debuff</h2>
                        <div class="section">

                            <div class="row">
                                <div class="col">
                                    <div class="row">
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Strength</mat-label>
                                                <input matInput type="number" placeholder="+/- Strength"
                                                    formControlName="strength">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Dexterity</mat-label>
                                                <input matInput type="number" placeholder="+/- Dexterity"
                                                    formControlName="dexterity">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Constitution</mat-label>
                                                <input matInput type="number" placeholder="+/- Constitution"
                                                    formControlName="constitution">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Intelligence</mat-label>
                                                <input matInput type="number" placeholder="+/- Intelligence"
                                                    formControlName="intelligence">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Wisdom</mat-label>
                                                <input matInput type="number" placeholder="+/- Wisdom"
                                                    formControlName="wisdom">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Charisma</mat-label>
                                                <input matInput type="number" placeholder="+/- Charisma"
                                                    formControlName="charisma">
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="row">
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Hit roll</mat-label>
                                                <input matInput type="number" placeholder="+/- Hit roll"
                                                    formControlName="hitRoll">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Damage roll</mat-label>
                                                <input matInput type="number" placeholder="+/- Damage roll"
                                                    formControlName="DamageRoll">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Saves</mat-label>
                                                <input matInput type="number" placeholder="+/- Saves"
                                                    formControlName="saves">
                                            </mat-form-field>
                                        </div>

                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>+/- HP</mat-label>
                                                <input matInput type="number" placeholder="+/- HP"
                                                    formControlName="hpMod">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>+/- Mana</mat-label>
                                                <input matInput type="number" placeholder="+/- Mana"
                                                    formControlName="manaMod">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>+/- Moves</mat-label>
                                                <input matInput type="number" placeholder="+/- Moves"
                                                    formControlName="movesMod">
                                            </mat-form-field>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->


                    <h2>Item flags</h2>
                    <div class="section section--check-box">
                        <div class="row" [formGroup]="itemForm.get('flags')">


                            <div class="col-2" *ngFor="let flag of flags">
                                <mat-checkbox [title]="flag.name" [formControlName]="flag.name"
                                    [checked]="hasFlag({id: flag.id, name:''})" (change)=updateSelectedFlags(flag.id)>
                                    {{flag.name}}
                                </mat-checkbox>
                            </div>
                        </div>
                    </div>

                    <h2>Extra flags</h2>
                    <div class="section">
                        <div class="row">
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Strength</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="strength">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Dexterity</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="dexterity">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Constitution</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="constitution">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Intelligence</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="intelligence">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Wisdom</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="wisdom">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Charisma</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="charisma">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Hit Points</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="hpMod">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Mana</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="manaMod">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Moves</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="movesMod">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Damage</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="damageRoll">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Hit Roll</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="hitRoll">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Spell Damage</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="spellMod">               
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Spell Saves</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="acMagicMod">               
                                </mat-form-field>
                            </div>

                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>AC</mat-label>
                                    <input matInput type="number" placeholder="" formControlName="acMod">               
                                </mat-form-field>
                            </div>
                        </div>
                    </div>


                    <h2>Descriptions</h2>
                    <div class="section">
                        <div class="row">
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Item Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="lookDescription"></textarea>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Examine Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="examDescription">>{{selectedItem?.name}}</textarea>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Room Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="roomDescription"></textarea>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Smell Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="smellDescription"></textarea>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Touch Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="touchDescription"></textarea>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="outline">
                                    <mat-label>Taste Description</mat-label>
                                    <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                        cdkAutosizeMinRows="2" cdkAutosizeMaxRows="20"
                                        formControlName="tasteDescription"></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>

                    <h2>Item room properties</h2>
                    <div class="section section--check-box">
                        <div class="row">
                            <div class="col-3">
                                <mat-checkbox formControlName="isHiddenInRoom" title="hides items in roam">Hidden in
                                    room</mat-checkbox>
                            </div>
                            <div class="col-3">
                                <mat-checkbox>Hidden (discoverable)</mat-checkbox>
                            </div>
                            <div class="col-3">
                                <mat-checkbox formControlName="isStuckInRoom" title="Item cannot be removed from room">
                                    Stuck in room</mat-checkbox>
                            </div>
                            <div class="col-3">

                                <mat-checkbox title="Updates every place that uses this item" formControlName="updateAllInstances">
                                    Update all instances
                                </mat-checkbox>


                                <p>Enabling this switch will update every instance of that item so be
                                    careful of making changes you don't intend to be global if the item is generic and
                                    used in several places.</p>



                            </div>
                        </div>
                    </div>

                    <h2>Miscellaneous Properties</h2>
                    <div class="section">
                        <div class="row">
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Condition</mat-label>
                                    <input matInput type="number" placeholder="Condition" formControlName="condition">
                                    <mat-hint align="start"><strong>1 - 100, 100 being perfect</strong>
                                    </mat-hint>
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="outline">
                                    <mat-label>Weight</mat-label>
                                    <input matInput type="number" placeholder="Weight" formControlName="weight">
                                </mat-form-field>
                            </div>
                            <!-- <div class="col-3">
                                <mat-form-field appearance="outline">
                                    <mat-label>Decay delay</mat-label>
                                    <input matInput type="number" placeholder="Decay delay">
                                </mat-form-field>
                            </div> -->
                        </div>
                    </div>

                    <!-- <div class="row">
                <div class="col-3">
                    <mat-form-field appearance="outline">
                        <input matInput type="number" placeholder="Forage Rank">
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="outline">
                        <input matInput type="number" placeholder="Item Uses">
                    </mat-form-field>
                </div>
                <div class="col-3">

                    <mat-checkbox>Infinite Use</mat-checkbox>

                </div>
            </div> -->

                    <button mat-raised-button color="primary" type="submit" [disabled]="itemForm.invalid">Add
                        Item</button>
                </form>
            </div>
        </div>
        <div class="col-4">
            <app-item-preview-component [itemForm]="itemForm"></app-item-preview-component>
        </div>
    </div>
</div>